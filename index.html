<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />

    <link rel="stylesheet" href="assets/css/style.css">


    <title>Project 1</title>
</head>

<body>

    <div id="header">

        <h2>Search for recipies and nutrition facts </h2>
    </div>


    <div class="flex-container">
        <div id="recipe">
            <h1>Recipe Name</h1>
            <input type="name" class="form-control-1" id="Name" placeholder="Enter Name" size="25">
        </div>

        <div id="calories">
            <h1>Calories</h1>
            <input type="name" class="form-control-2" id="minCal" placeholder="Min" size="5">
            <input type="name" class="form-control-2" id="maxCal" placeholder="Max" size="5">
        </div>

        <div id="cuisineType">
            <h1>Cuisine type</h1>
            <select class="selectpicker" multiple data-live-search="true">
        <option value="american">American</option>
        <option value="asian">Asian</option>
        <option value="british">British</option>
        <option value="carribean">Carribean</option>
        <option value="central europe">Central Europe</option>
        <option value="chinese">Chinese</option>
        <option value="eastern europe">Eastern europe</option>
        <option value="french">French</option>
        <option value="indian">Indian</option>
        <option value="italian">Italian</option>
        <option value="japanese">Japanese</option>
        <option>...</option>
      </select>
        </div>


        <div id="healthLabels">
            <h1>Heath Labels</h1>
            <select class="selectpicker" multiple data-live-search="true">
        <option value="vegan">Vegan</option>
        <option value="vegetarian">Vegetarian</option>
        <option value="lowFat">Low-Fat</option>
        <option value="lowSodium">Low-Sodium</option>
        <option value="glutenFree">Gluten-Free</option>
        <option value="keto">Keto</option>
        <option value="kosher">Kosher</option>
      </select>
        </div>

        <div id="Submit">
            <br>
            <button type="button" class="btn btn-primary" id="submit">Submit</button>
        </div>

    </div>

    <br>
    <div id="recipe-list"></div>






    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js " integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1 " crossorigin="anonymous "></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js " integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM " crossorigin="anonymous "></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js "></script>

    <!-- Resources -->
    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/material.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>

    <script>
        //Search String and API Data
        const app_id = "60bec2ae";
        const app_key = "411a6ce9c56353f66bde23265db8f48d";
        let queryURL = `https://api.edamam.com/search?`

        //Get Form Data
        //Query String
        let q = "vegan" //$("#foodName ").val();
        let cousineType = "chinese" //$("#cousineType ").val();

        var caloriesMin = 500 //$("#caloriesMin ").val();
        var caloriesMax = 1000 //$("#caloriesMax ").val();

        let health = ["peanut-free ", "tree-nut-free"];


        $.ajax({
            url: queryURL,
            method: "GET",
            data: {
                q,
                app_id,
                app_key,
                health,
                calories: `${caloriesMin}-${caloriesMax}`
            },
            success: function(response) {
                console.log(response);

                addRecipes(response.hits);
            },
            error: function(xhr) {
                console.log(xhr);
            }
        });

        function addRecipes(recipeArray) {

            console.log(recipeArray);

            for (let index = 0; index < recipeArray.length; index++) {

                let rLabel = recipeArray[index].recipe.label;
                let rCals = Math.floor(recipeArray[index].recipe.calories);
                let rImg = recipeArray[index].recipe.image;
                let rLink = recipeArray[index].recipe.url;

                ///
                let rIngredientList = `<ul>`
                for (let i = 0; i < recipeArray[index].recipe.ingredients.length; i++) {
                    rIngredientList += `<li>${recipeArray[index].recipe.ingredients[i].food} </li>`
                }
                rIngredientList += `</ul>`
                    ///

                let rTagList = ``;
                let healthLabels = recipeArray[index].recipe.healthLabels; //Array

                if (healthLabels.includes("Gluten-Free")) {
                    rTagList += `<span class="badge badge-pill badge-danger mr-2">Gluten-Free</span>`;
                }

                if (healthLabels.includes("Keto")) {
                    rTagList += `<span class="badge badge-pill badge-warning mr-2">Keto</span>`;
                }

                if (healthLabels.includes("Vegan")) {
                    rTagList += `<span class="badge badge-pill badge-success mr-2">Vegan</span>`;
                }

                if (healthLabels.includes("Low-Sodium")) {
                    rTagList += `<span class="badge badge-pill badge-primary mr-2">Low-Sodium</span>`;
                }

                if (healthLabels.includes("Vegetarian")) {
                    rTagList += `<span class="badge badge-pill badge-info">Vegetarian</span>`;
                }



                $("#recipe-list").append(
                        `<div class="accordion" id="recipe-list">
                  <div class="card">
                  <div class="card-header" id="heading${index}">
                  <h6 class="mb-0">
                  <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse${index}" aria-expanded="true" aria-controls="collapse${index}">
                   ${rLabel}
                    </button> Calories: ${rCals}kcal
                    ${rTagList}
                  </h6>
                  </div>
                  <div id="collapse${index}" class="collapse" aria-labelledby="heading${index}" data-parent="#recipe-list">
                  <div class="card-body">

                  <div class="row">
                      <div class="col-3 text-center">
                          <img src=${rImg} class="img-fluid" style="max-width:100%;" alt="Recipe Image :)">
                          <br>
                          <br>
                          <a class="btn btn-primary center-block" href=${rLink} role="button">Recipe</a>

                      </div>
                      <div class="col-3 ">
                          <h4>Ingredients:</h4>
                          ${rIngredientList}
                      </div>
                      <div class="col-6 ">
                      <br>
                      <br>
                      <br>
                      <br>
                              <div id="chart${rLabel}"  style="width:100%; height:100%; position:relative; right: 80px; bottom: 70px;" ></div>		

                  </div>

                  </div>

              </div>
          </div>
      </div>
  </div>`
                    ) //end of template

                // Add data
                myData = [{
                    "country": "Carbs",
                    "visits": recipeArray[index].recipe.totalDaily.CHOCDF.quantity
                }, {
                    "country": "China",
                    "visits": recipeArray[index].recipe.totalDaily.CHOCDF.quantity
                }, {
                    "country": "Japan",
                    "visits": 1809
                }, {
                    "country": "Germany",
                    "visits": 1322
                }, {
                    "country": "UK",
                    "visits": 1122
                }, {
                    "country": "France",
                    "visits": 1114
                }, {
                    "country": "India",
                    "visits": 984
                }, {
                    "country": "Spain",
                    "visits": 711
                }, {
                    "country": "Netherlands",
                    "visits": 665
                }, {
                    "country": "Russia",
                    "visits": 580
                }, {
                    "country": "South Korea",
                    "visits": 443
                }, {
                    "country": "Canada",
                    "visits": 441
                }];
                createChart(myData, "chart" + rLabel);
            }
        }
    </script>
    <!-- Chart code -->
    <script>
        function createChart(cNutrients, cName) {

            am4core.ready(function() {

                // Themes begin
                am4core.useTheme(am4themes_animated);
                // Themes end

                // Create chart instance
                var chart = am4core.create(cName, am4charts.XYChart);
                //chart.scrollbarX = new am4core.Scrollbar();

                // Add data
                chart.data = cNutrients;

                // Create axes
                var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
                categoryAxis.dataFields.category = "country";
                categoryAxis.renderer.grid.template.location = 0;
                categoryAxis.renderer.minGridDistance = 30;
                categoryAxis.renderer.labels.template.horizontalCenter = "right";
                categoryAxis.renderer.labels.template.verticalCenter = "middle";
                categoryAxis.renderer.labels.template.rotation = 270;
                categoryAxis.tooltip.disabled = false;
                categoryAxis.renderer.minHeight = 100;

                var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
                valueAxis.renderer.minWidth = 100;

                // Create series
                var series = chart.series.push(new am4charts.ColumnSeries());
                series.sequencedInterpolation = true;
                series.dataFields.valueY = "visits";
                series.dataFields.categoryX = "country";
                series.tooltipText = "[{categoryX}: bold]{valueY}[/]";
                series.columns.template.strokeWidth = 0;

                series.tooltip.pointerOrientation = "vertical";

                series.columns.template.column.cornerRadiusTopLeft = 10;
                series.columns.template.column.cornerRadiusTopRight = 10;
                series.columns.template.column.fillOpacity = 0.8;

                // on hover, make corner radiuses bigger
                var hoverState = series.columns.template.column.states.create("hover");
                hoverState.properties.cornerRadiusTopLeft = 0;
                hoverState.properties.cornerRadiusTopRight = 0;
                hoverState.properties.fillOpacity = 1;

                series.columns.template.adapter.add("fill", function(fill, target) {
                    return chart.colors.getIndex(target.dataItem.index);
                });
                chart.responsive.enable = true;
                // Cursor
                chart.cursor = new am4charts.XYCursor();

            }); // end am4core.ready()

        }
    </script>


    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/app.js"></script>


</body>

</html>